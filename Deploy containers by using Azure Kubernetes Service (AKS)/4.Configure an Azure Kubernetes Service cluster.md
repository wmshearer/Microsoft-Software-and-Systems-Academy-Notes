# AKS Governance, Security, and Namespaces

## Azure Policy Add-on for AKS
- Extends Azure Policy to Kubernetes clusters
- Evaluates and enforces governance policies
- Uses Kubernetes admission control
- Reports compliance centrally in Azure
- Requires Microsoft.PolicyInsights resource provider

## Enable Azure Policy Add-on
- Enabled at the AKS cluster level
- Enforcement may take several minutes
- Status visible in cluster Policies blade
- Policies can be audited or enforced

## Assign Policy Definitions to AKS
- Requires Azure RBAC permissions
- Built-in roles with permission:
  - Resource Policy Contributor
  - Owner
- Policy scope must include the AKS cluster
- Enforcement modes:
  - Enabled: Noncompliant requests are denied
  - Disabled: Violations reported only (audit mode)
- Compliance results visible in Azure Policy

## Host-Based Encryption in AKS
- Encrypts data at rest on the VM host
- Data encrypted before flowing to Azure Storage
- Temp disks encrypted with platform-managed keys
- OS and data disk caches encrypted at rest
- Supports:
  - Platform-managed keys
  - Customer-managed keys (BYOK)

## Host-Based Encryption vs SSE
- Server-side encryption (SSE):
  - Encryption handled by Azure Storage
- Host-based encryption:
  - Encryption handled by VM host
  - Adds protection before storage layer

## Host-Based Encryption Limitations
- Must be enabled at:
  - Cluster creation, or
  - New node pool creation
- Requires:
  - VM Scale Sets
  - Supported regions
  - Supported VM sizes

## Enable Host-Based Encryption (CLI)

### New Cluster
```bash
az aks create \
  --name myAKSCluster \
  --resource-group myResourceGroup \
  --node-vm-size Standard_DS2_v2 \
  --location westus2 \
  --enable-encryption-at-host
```

### Existing Cluster (New Node Pool)
```bash
az aks nodepool add \
  --name hostencrypt \
  --cluster-name myAKSCluster \
  --resource-group myResourceGroup \
  --node-vm-size Standard_DS2_v2 \
  --enable-encryption-at-host
```

## Kubernetes Namespaces
- Logical isolation boundary in a cluster
- Used for multi-team and multi-workload environments
- Resources are unique within a namespace
- Namespaces cannot be nested
- Each resource belongs to only one namespace

## Default Namespaces
- default:
  - Used when no namespace is specified
- kube-system:
  - Core Kubernetes services
- kube-public:
  - Cluster-wide visible resources

## Logical Isolation with Namespaces
- Allows multiple workloads in one cluster
- Higher pod density than separate clusters
- Reduces idle compute
- Works well with cluster autoscaler
- Cost-efficient for medium to large environments

## Create Custom Namespace
- Created at cluster level
- Can be managed via YAML
- Used to isolate teams, apps, or environments

