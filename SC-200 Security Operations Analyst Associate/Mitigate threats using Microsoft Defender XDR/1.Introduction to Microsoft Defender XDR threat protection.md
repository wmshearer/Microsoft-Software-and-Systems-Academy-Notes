# Introduction to Microsoft Defender XDR (Extended Detection and Response) Threat Protection

## XDR Detection and Mitigation Use Cases

- Microsoft Defender XDR correlates signals across endpoint, identity, email, and cloud
- Goal is rapid detection, containment, remediation, and restoration of access

## Detection of a Compromised Endpoint

- Malware can originate from:
  - Personal email (not protected by Defender for Office 365)
  - USB or other removable media
- User opens malicious attachment
- Malware infects endpoint without user awareness
- Microsoft Defender for Endpoint (MDE):
  - Detects malicious payload
  - Raises alert to Security Operations
  - Provides threat details for investigation

## Containment via Identity and Device Risk

- MDE (Microsoft Defender for Endpoint) signals Microsoft Intune that device risk level has changed
- Intune Compliance Policy evaluates MDE risk severity
- Device marked noncompliant
- Microsoft Entra ID Conditional Access:
  - Blocks user access to corporate apps and resources
  - Enforces Zero Trust based on device risk

## Remediation

- Threat remediation options in MDE:
  - Fully automated remediation
  - Automated remediation with analyst approval
  - Manual analyst-led investigation and cleanup
- Threat intelligence is shared:
  - Across the tenant
  - Across Microsoftâ€™s global MDE customer base
  - Enriched into Microsoft Threat Intelligence

## Share Intelligence and Restore Access

- After remediation:
  - MDE updates device risk status
  - Intune updates compliance
  - Microsoft Entra ID Conditional Access restores access
- Threat signals propagate to:
  - Microsoft Defender for Office 365
  - Microsoft Defender for Cloud
  - Other Microsoft security products
- Enables detection and remediation of threat variants across email, collaboration, Azure, and cloud workloads

## Access Restriction During Compromise

- Conditional Access enforces restrictions because:
  - MDE updates Intune
  - Intune updates Entra ID device compliance
- Effects:
  - Blocks new corporate resource access
  - Terminates sessions that support Continuous Access Evaluation (CAE)
  - Allows general internet use without corporate authentication

## Access Restored After Remediation

- Once endpoint is clean:
  - MDE signals Intune
  - Intune updates Entra ID
  - Conditional Access allows corporate access again
- Balances:
  - Security risk reduction
  - Minimal user productivity impact

# Microsoft Defender XDR in a SOC

## Modern SOC Integration

- Microsoft Defender XDR integrates with Microsoft Sentinel
- Provides unified detection, investigation, and response
- Single console for endpoint, email, identity, and cloud signals

## Security Operations Model

- SOC functions vary by organization size
- Teams are defined by function, not hierarchy
- Functions collaborate closely

## Triage and Automation (Tier 1)

- Focus on reactive alerts
- Automation:
  - Near real-time remediation of known attack patterns
- Triage analysts:
  - Handle high-volume, well-known incidents
  - Approve automated remediation
  - Escalate suspicious or complex cases

### Key Principles

- Alert quality target:
  - 90% true positive for analyst-actionable alerts
- Alert sources:
  - XDR produces highest quality alerts
  - Others include user reports and log-based alerts
- Automation reduces manual workload
- Tool integration:
  - Microsoft Defender XDR unifies endpoint, email, identity
- Scope focus:
  - Email
  - Endpoint AV
  - Initial user reports

## Investigation and Incident Management (Tier 2)

- Escalation point from Tier 1
- Handles:
  - Behavioral alerts
  - Business-critical assets
  - Ongoing attack campaigns
- Responsibilities:
  - Deep investigation of complex, multi-stage attacks
  - Pilot new alert types
  - Document processes for Tier 1 and automation
- Uses:
  - Microsoft Defender XDR
  - Microsoft Sentinel for broader context
- Incident management:
  - Coordination with legal, communications, leadership, and business stakeholders

## Hunt and Incident Management (Tier 3)

- Focus on advanced and high-impact threats
- Hunt activities:
  - Proactive, hypothesis-driven threat hunting
  - Advanced forensics
  - Alert and automation refinement
- Interface with red/purple teams

## Incident Lifecycle Example

- Tier 1 investigates malware alert in Defender XDR
- Determines advanced remediation is required
- Escalates to Tier 2
- Tier 2 completes investigation and remediation
- Tier 3 later reviews closed cases to identify:
  - Autoremediation opportunities
  - Patterns across incidents
  - Root causes or higher-risk scenarios

## Threat Intelligence

- Supports all SOC functions
- Includes:
  - Reactive research for live incidents
  - Proactive research on attacker groups and trends
  - Strategic analysis to guide investments and priorities

# Microsoft Security Graph

## Microsoft Graph Overview

- Unified API for Microsoft 365, Windows, and Enterprise Mobility + Security
- Single endpoint:
  - `https://graph.microsoft.com`
  - Versions: `v1.0` and `beta`
- Access via REST APIs or SDKs

## Data Sources Exposed

- Microsoft 365 services (Exchange, SharePoint, Teams, OneDrive, etc.)
- Enterprise Mobility + Security:
  - Microsoft Entra ID
  - Intune
  - Defender solutions
- Windows services
- Dynamics 365

## Microsoft Graph Security API

- Acts as a broker between security providers
- Federates requests to multiple security services
- Aggregates results into a common schema

## Security Graph Use Cases

- Correlate alerts across multiple sources
- Stream alerts to SIEMs
- Push threat indicators to security controls
- Enrich investigations with context
- Automate SecOps workflows

## Graph API Versions

- `v1.0`:
  - Generally available
- `beta`:
  - Preview features
  - Subject to breaking changes

## Advanced Hunting via Graph API

- Supported for Security Operations Analysts
- Uses Kusto Query Language (KQL)
- Method: `runHuntingQuery`

### Example

`POST https://graph.microsoft.com/v1.0/security/runHuntingQuery`

`{
  "Query": "DeviceProcessEvents | where InitiatingProcessFileName =~ \"powershell.exe\" | project Timestamp, FileName, InitiatingProcessFileName | order by Timestamp desc | limit 2"
}`

- Queries can also be tested using Graph Explorer

# Module Assessment Answers

## Question 1
- Which Microsoft Defender XDR solution can detect an Active Directory Domain compromise?
- Answer: Microsoft Defender for Identity

## Question 2
- Which Microsoft Defender XDR solution can detect a phishing email?
- Answer: Microsoft Defender for Office 365

## Question 3
- Which Microsoft Defender XDR solution can detect a malware installation?
- Answer: Microsoft Defender for Endpoint
