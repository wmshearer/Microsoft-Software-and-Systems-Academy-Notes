# Lab: Plan an IPv4 Addressing Scheme

## Lab Scenario (what matters)
- Toronto (regional office) has address space: 172.16.18.0/18
- Toronto already uses:
  - 172.16.18.0/24 = network devices + printers
  - 172.16.19.0/24 = servers
  - 172.16.20.0/24 → 172.16.52.0/24 = wired desktops (wired client pool)
  - 172.16.53.0/24 → 172.16.60.0/24 = wireless devices (wireless client pool)
- Branch offices (no local servers planned):
  - Houston
  - Mexico City
  - Portland
- REQUIREMENTS:
  - Wired vs Wireless must be DIFFERENT IP ranges
  - Each branch office gets dedicated IP ranges
  - Keep subnets simple (use /24s where possible)
  - Must cover ALL potential clients (including laptops that can use both)

# Exercise 1: Plan IPv4 Address Assignments

## Task 1: Plan the IPv4 implementation

### How to determine required IP addresses per location
- Count every device type that could request an address
- Separate into:
  - Wired-capable devices
  - Wireless-capable devices
- Add enough capacity for growth + gateway + reserved IPs (best practice), but in this lab we keep it simple using /24s

### How laptops with wired + wireless affect address requirements
- Laptops can connect to BOTH networks
- That means you must budget IPs in BOTH pools:
  - 1 IP from wired range (when docked/ethernet)
  - 1 IP from wireless range (when on Wi-Fi)

### Simplest subnet size to use
- /24 per subnet (simple, common, easy to manage)
- Usable hosts per /24 ≈ 254 (minus 1 usually for gateway → still plenty)

### Houston: count potential clients
- Wired-capable:
  - 300 desktops + 100 laptops = 400 wired clients
- Wireless-capable:
  - 100 laptops + 50 tablets = 150 wireless clients

### Houston: how many /24 subnets needed?
- Wired: 400 clients → needs 2 x /24 (2 x 254 usable ≈ 508)
- Wireless: 150 clients → 1 x /24

### Mexico City: count potential clients
- Wired-capable:
  - 100 desktops + 50 laptops = 150 wired clients
- Wireless-capable:
  - 50 laptops + 20 tablets = 70 wireless clients

### Mexico City: how many /24 subnets needed?
- Wired: 150 → 1 x /24
- Wireless: 70 → 1 x /24

### Portland: count potential clients
- Wired-capable:
  - 100 desktops + 75 laptops = 175 wired clients
- Wireless-capable:
  - 75 laptops + 150 tablets = 225 wireless clients

### Portland: how many /24 subnets needed?
- Wired: 175 → 1 x /24
- Wireless: 225 → 1 x /24

### Choose wired subnets (must come from 172.16.20.0/24 → 172.16.52.0/24)
Example clean assignment (one of many valid answers):
- Houston (wired):     172.16.30.0/24 and 172.16.31.0/24
- Mexico City (wired): 172.16.35.0/24
- Portland (wired):    172.16.40.0/24

### Choose wireless subnets (must come from 172.16.53.0/24 → 172.16.60.0/24)
Example clean assignment (one of many valid answers):
- Houston (wireless):     172.16.55.0/24
- Mexico City (wireless): 172.16.56.0/24
- Portland (wireless):    172.16.57.0/24

## Results (Exercise 1)
- Each branch has dedicated wired + wireless ranges
- Wired and wireless are separated
- /24 subnets keep design simple and scalable


# Exercise 2: Verify IPv4 Communication

## Scenario (what you’re proving)
- London HQ must reach Toronto server TOR-SVR1
- Verify baseline connectivity
- Then intentionally “break” LON-CL1 and LON-CL2 using scripts for the next troubleshooting exercise

## Task 1: Verify IPv4 traffic (from LON-DC1)
- Sign in LON-DC1 as Contoso\Administrator (Pa55w.rd)
- Open Windows PowerShell ISE
- Run:
Test-NetConnection 172.16.0.1

- Confirm:
  - Response from EU-RTR (London default gateway)

- Run:
Test-NetConnection -TraceRoute TOR-SVR1.contoso.com

- Confirm:
  - TraceRoute reaches TOR-SVR1 (Toronto server)

## Task 2: Prepare LON-CL1 for troubleshooting
- Switch to LON-CL1
- Sign in as Contoso\Administrator (Pa55w.rd)

- Copy the script to Desktop:
  - Open File Explorer
  - Go to:
\\LON-DC1\Labfiles\Mod01
  - Copy:
LON-CL1.ps1
  - Paste to Desktop
  - IMPORTANT: don’t open/edit it

- Run it:
  - Right-click LON-CL1.ps1 → Run with PowerShell
  - If prompted: type y → Enter

## Task 3: Prepare LON-CL2 for troubleshooting
- Switch to LON-CL2
- Sign in as Contoso\Administrator (Pa55w.rd)

- Copy the script to Desktop:
  - Open File Explorer
  - Go to:
\\LON-DC1\Labfiles\Mod01
  - Copy:
LON-CL2.ps1
  - Paste to Desktop
  - IMPORTANT: don’t open/edit it

- Run it:
  - Right-click LON-CL2.ps1 → Run with PowerShell
  - If prompted: type y → Enter

## Results (Exercise 2)
- Verified London → router gateway works
- Verified London → Toronto server works
- Prepared LON-CL1 + LON-CL2 with scripted issues for troubleshooting


# Exercise 3: Troubleshoot IPv4

## Scenario summary
- LON-CL1 (Arnold): can’t connect to anything
- LON-CL2 (Amy): can reach London, but not Toronto

## Task 1: Fix LON-CL1 connectivity (APIPA issue)
- On LON-CL1 open PowerShell ISE
- Test internal connectivity:
Test-NetConnection LON-DC1

- Confirm:
  - PingSucceeded: False

- Check IP:
Get-NetIPAddress

- Confirm:
  - London_Network has 169.254.x.x (APIPA)
  - Meaning: DHCP was expected but no lease received

- Set correct static IPv4:
New-NetIPAddress -InterfaceAlias "London_Network" -IPAddress 172.16.0.50 -PrefixLength 24

- Verify Toronto reachability:
Test-NetConnection TOR-SVR1

- Confirm:
  - Reply from 172.16.18.20
  - PingSucceeded: True

## Task 2: Fix LON-CL2 routing (wrong default gateway)
- On LON-CL2 open PowerShell ISE

- Confirm London DC works:
Test-NetConnection LON-DC1

- Confirm Toronto fails:
Test-NetConnection TOR-SVR1

- Confirm router reachable:
Test-NetConnection 172.16.0.1

- Trace route to Toronto:
Test-NetConnection -TraceRoute 172.16.18.20

- Check config:
Get-NetIpConfiguration

- Confirm problem:
  - IPv4DefaultGateway incorrectly set to 172.16.0.2 (should be 172.16.0.1)

- Remove bad IP config line:
Remove-NetIPAddress -InterfaceAlias "London_Network" -IPAddress 172.16.0.51 -PrefixLength 24 -DefaultGateway 172.16.0.2 -Confirm:$false

- Re-add with correct gateway:
New-NetIPAddress -InterfaceAlias "London_Network" -IPAddress 172.16.0.51 -PrefixLength 24 -DefaultGateway 172.16.0.1 -Confirm:$false

- Verify Toronto works now:
Test-NetConnection TOR-SVR1

- Confirm:
  - Reply from 172.16.18.20
  - PingSucceeded: True

## Results (Exercise 3)
- LON-CL1 fixed (was APIPA / no DHCP lease)
- LON-CL2 fixed (wrong default gateway)
- London clients can copy files / reach Toronto server again
