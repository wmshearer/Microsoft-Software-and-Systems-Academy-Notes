# Lab A: Plan and Implement DNS Name Resolution

## Lab Scenario
Contoso users in the Sydney location report that connectivity to websites and shared resources is slow and sometimes results in time-out errors. Currently, the Sydney office only contains Windows 11 client computers. Wide area network (WAN) communication between Sydney and London, where infrastructure servers are hosted, has been intermittent and is the primary cause of the issues.

You have been asked to implement a Domain Name System (DNS) name-resolution solution in Sydney that will resolve the majority of these issues.

### Current DNS Structure
- ISP DNS server: **INET1 (131.107.0.100)**  
  - Provides DNS resolution and forwarding for internet-based domain names  
  - Hosts **Adatum.com** (internet-accessible)

- **Adatum.com**
  - Web and mail services
  - Hosted on INET1
  - Accessible from inside Contoso network

- **TreyResearch.net**
  - Internal resources used by Contoso employees
  - DNS zone hosted on **LON-SVR1**

- **Contoso.com**
  - Internal domain
  - DNS hosted on **LON-DC1**

### Goal
Configure a DNS server in Sydney named **SYD-SVR1** to:
- Resolve local DNS queries
- Resolve **Adatum.com** and **TreyResearch.net**
- Forward **Contoso.com** queries to an authoritative DNS server

### Requirements
- Forward internet DNS queries to **INET1**
- Configure conditional forwarding for:
  - Contoso.com
  - Adatum.com
- Host **TreyResearch.net** locally in Sydney

### Virtual Machines
- **INET1 (131.107.0.100)** — Internet DNS, Adatum.com
- **EU-RTR** — Router
- **LON-DC1 (172.16.0.10)** — DNS for Contoso.com
- **LON-SVR1 (172.16.0.11)** — DNS for TreyResearch.net
- **SYD-SVR1 (172.16.19.20)** — Sydney DNS server

------------------------------------------------------------

## Exercise 1: Planning DNS Name Resolution

### Scenario
You need to plan DNS name resolution for the Sydney office.

### Task 1: Plan the DNS infrastructure to support name resolution

**Question:** What is the first step in implementing your new DNS plan for the Sydney office?  
**Answer:** Install the DNS Server role on SYD-SVR1.

**Question:** How will you configure SYD-SVR1 to resolve DNS queries for internet-based addresses?  
**Answer:** Configure forwarding to INET1 (131.107.0.100).

**Question:** How will you configure SYD-SVR1 to resolve DNS queries for the Adatum.com namespace?  
**Answer:** Configure conditional forwarding for Adatum.com to INET1.

**Question:** How will you configure SYD-SVR1 to resolve queries for TreyResearch.net?  
**Answer:** Create a secondary zone for TreyResearch.net on SYD-SVR1.

**Question:** How will you configure SYD-SVR1 to resolve queries for Contoso.com?  
**Answer:** Configure conditional forwarding for Contoso.com to LON-DC1 (172.16.0.10).

### Results
After completing this exercise, you have planned the DNS infrastructure for Sydney.

------------------------------------------------------------

## Exercise 2: Implementing DNS Servers and Zones

### Scenario
Install and configure DNS name resolution on SYD-SVR1 according to the DNS plan.

### Main Tasks
- Install DNS Server role
- Configure DNS forwarding
- Configure conditional forwarding
- Configure secondary zones
- Validate zone transfer

------------------------------------------------------------

### Task 1: Install the DNS Server Role on SYD-SVR1

1. Sign in to **SYD-SVR1** as `Contoso\Administrator` / `Pa55w.rd`
2. Open **Server Manager**
3. Select **Add roles and features**
4. Click **Next** through:
   - Before you begin
   - Installation type
   - Destination server
5. Select **DNS Server**
6. Select **Add Features**
7. Click **Next** through:
   - Features
   - DNS Server
8. Select **Install**
9. When installation succeeds, select **Close**

------------------------------------------------------------

### Task 2: Configure DNS Forwarding to INET1

1. Open **Server Manager**
2. Select **Tools → DNS**
3. Right-click **SYD-SVR1** → **Properties**
4. Select the **Forwarders** tab
5. Select **Edit**
6. Enter `131.107.0.100`
7. Select **OK**
8. Select **OK** again

------------------------------------------------------------

### Task 3: Configure DNS Conditional Forwarding

1. In **DNS Manager**, expand **SYD-SVR1**
2. Right-click **Conditional Forwarders** → **New Conditional Forwarder**
3. DNS Domain: `Contoso.com`
4. IP Address: `172.16.0.10`
5. Select **OK**
   - Red X icon may appear temporarily — this is normal

6. Right-click **Conditional Forwarders** → **New Conditional Forwarder**
7. DNS Domain: `Adatum.com`
8. IP Address: `131.107.0.100`
9. Select **OK**

------------------------------------------------------------

### Task 4: Configure Secondary Zones and Zone Transfer

#### On SYD-SVR1
1. Open **DNS Manager**
2. Right-click **Forward Lookup Zones** → **New Zone**
3. Select **Secondary zone**
4. Zone name: `TreyResearch.net`
5. Master DNS Server: `172.16.0.11`
6. Select **Finish**

#### On LON-SVR1
1. Open **DNS Manager**
2. Expand **Forward Lookup Zones**
3. Right-click **TreyResearch.net** → **Properties**
4. Select **Zone Transfers** tab
5. Select **Only to the following servers**
6. Add `172.16.19.20`
7. Select **OK**
8. Select **Notify**
9. Choose **The following servers**
10. Add `172.16.19.20`
11. Select **OK**

#### Back on SYD-SVR1
- Verify SOA and NS records appear for **LON-SVR1.contoso.com**
- Allow 1–2 minutes for synchronization

------------------------------------------------------------

### Task 5: Validate Zone Transfer

#### On LON-SVR1
1. Right-click **TreyResearch.net** → **New Host (A or AAAA)**
2. Name: `ATL-SVR1`
3. IP Address: `172.16.18.125`
4. Select **Add Host** → **OK** → **Done**

#### On SYD-SVR1
1. Right-click **TreyResearch.net** → **Refresh**
2. Verify **ATL-SVR1** record appears

------------------------------------------------------------

## Results
After completing this lab, you have successfully installed and configured DNS on **SYD-SVR1**, including forwarding, conditional forwarding, and secondary zone replication.


# Lab B: Integrate DNS with AD DS

## Lab Scenario
After making additional improvements to the wide area network (WAN) connection between the London and Sydney locations, you have been asked to enable SYD-SVR1 to update and replicate records for the Contoso.com domain.

### Prerequisites
You must complete the following lab before beginning this lab:
- 0401 – Planning and implementing DNS name resolution

------------------------------------------------------------

## Exercise 1: Integrate DNS with AD DS

### Scenario
You need to deploy another Active Directory–integrated DNS server in the Contoso.com domain. To accomplish this, you will promote SYD-SVR1 to a domain controller and integrate DNS with the Active Directory Domain Services (AD DS) database.

### Main Tasks
- Review DNS resource records for the Sydney location
- Install AD DS on SYD-SVR1
- Review DNS resource records on SYD-SVR1 after promotion

------------------------------------------------------------

### Task 1: Review Resource Records for the Sydney Location

1. If necessary, sign in to **SYD-SVR1** as `Contoso\Administrator` / `Pa55w.rd`
2. Open **Server Manager**
3. Select **Tools → DNS**
4. In the DNS Manager console:
   - Expand **SYD-SVR1**
   - Expand **Forward Lookup Zones**
5. Observe that **Contoso.com** does **not** appear as a hosted zone
6. Expand **Conditional Forwarders**
7. Right-click **Contoso.com** → **Delete**
8. In the confirmation window, select **Yes**
9. Close the **DNS Manager** console

------------------------------------------------------------

### Compare DNS Records on LON-DC1

1. Switch to **LON-DC1**
2. Sign in as `Contoso\Administrator` / `Pa55w.rd` if necessary
3. Open **Server Manager**
4. Select **Tools → DNS**
5. In the DNS console:
   - Expand **LON-DC1**
   - Expand **Forward Lookup Zones**
   - Select **Contoso.com**
6. Review the resource records in the details pane
7. Leave the DNS Manager console **open**

------------------------------------------------------------

### Task 2: Install AD DS on SYD-SVR1

1. Switch back to **SYD-SVR1**
2. Open **Server Manager**
3. Select **Add roles and features**
4. Click **Next** through:
   - Before you begin
   - Installation type
   - Destination server
5. On **Select server roles**, select **Active Directory Domain Services**
6. When prompted, select **Add Features**
7. Select **Next** through:
   - Features
   - Active Directory Domain Services
8. On **Confirm installation selections**, select **Install**
9. When installation succeeds, select **Promote this server to a domain controller**

------------------------------------------------------------

### Active Directory Domain Services Configuration Wizard

1. On **Deployment Configuration**, ensure:
   - **Add a domain controller to an existing domain** is selected
2. Select **Next**
3. On **Domain Controller Options**:
   - Ensure **DNS server** is selected
   - Ensure **Global Catalog (GC)** is selected
   - Enter `Pa55w.rd` for the DSRM password (both fields)
4. Select **Next**
5. On **DNS Options**, select **Next**
6. On **Additional Options**, select **Next**
7. On **Paths**, select **Next**
8. On **Review Options**, select **Next**
9. On **Prerequisites Check**, select **Install**

NOTE: The server will automatically restart.

------------------------------------------------------------

### Post-Restart Network Configuration on SYD-SVR1

1. After restart, sign in to **SYD-SVR1** as `Contoso\Administrator` / `Pa55w.rd`
2. Right-click the **Network icon** in the taskbar
3. Select **Open Network and Internet settings**
4. On the **Status** page, select **Network and Sharing Center**
5. Select the **PAC_WAN** hyperlink
6. In the **PAC_WAN Status** window, select **Properties**
7. Select **Internet Protocol Version 4 (TCP/IPv4)** → **Properties**
8. Configure DNS servers:
   - Preferred DNS server: `172.16.19.20`
   - Alternate DNS server: `172.16.0.10`
9. Select **OK**
10. Select **Close** twice
11. Close all remaining network windows

------------------------------------------------------------

### Task 3: Review Resource Records on SYD-SVR1

1. On **SYD-SVR1**, open **Server Manager**
2. Select **Tools → DNS**
3. In DNS Manager:
   - Expand **SYD-SVR1**
   - Expand **Forward Lookup Zones**
   - Select **Contoso.com**
4. Right-click **Contoso.com** → **Properties**
5. Select the **Start of Authority (SOA)** tab
6. Verify **SYD-SVR1** is listed as the **Primary server**
7. Select **Cancel**

------------------------------------------------------------

### Verify DNS Replication

1. With **Contoso.com** still selected, review the resource records
2. Confirm the records match those seen earlier on **LON-DC1**
3. Right-click **Contoso.com** → **New Host (A or AAAA)**
4. Enter:
   - Name: `SYD-CL1`
   - IP address: `172.16.19.150`
5. Select **Add Host**
6. Select **OK**, then **Done**

------------------------------------------------------------

### Confirm Replication on LON-DC1

1. Switch to **LON-DC1**
2. In **DNS Manager**, right-click **Contoso.com** → **Refresh**
3. Verify that the **SYD-CL1** host record appears

------------------------------------------------------------

### If Replication Does Not Occur

1. Open **Server Manager**
2. Select **Tools → Active Directory Sites and Services**
3. Expand:
   - Sites
   - Default-First-Site-Name
   - Servers
4. Expand **LON-DC1**
5. Select **NTDS Settings**
6. Right-click the replication link → **Replicate Now**
7. Select **OK**
8. Close **Active Directory Sites and Services**
9. Refresh the **Contoso.com** zone again in DNS Manager

------------------------------------------------------------

## Results
After completing this lab, you have successfully promoted SYD-SVR1 to a domain controller and integrated DNS with Active Directory Domain Services. DNS records now replicate between London and Sydney.


## LAB C: CONFIGURE ADVANCED DNS SETTINGS

### Scenario
You want to simplify DNS zone management by configuring **DNS policies** so that users in different geographic locations receive **different IP addresses** when resolving the same DNS name. You will configure, validate, and troubleshoot DNS policies in Windows Server.

Prerequisites:
- 0401 – Planning and implementing DNS name resolution
- 0402 – Integrating DNS with AD DS

------------------------------------------------------------

## EXERCISE 1: CONFIGURING DNS POLICIES

### Task 1: Verify DNS name resolution BEFORE configuring DNS policies

1. Switch to **LON-DC1** and sign in as `Contoso\Administrator` / `Pa55w.rd`.
2. Open **Server Manager** → **Tools** → **DNS**.
3. Expand **LON-DC1** → **Forward Lookup Zones** → **Contoso.com**.
4. Right-click **Contoso.com** → **New Alias (CNAME)**.
5. Configure:
   - Alias name: `www`
   - Fully qualified domain name (FQDN): `LON-DC1.Contoso.com`
6. Select **OK**.

7. Switch to **TOR-SVR1** and sign in as `Contoso\Administrator` / `Pa55w.rd`.
8. Open **Windows PowerShell ISE**.
9. Run:
   - `ipconfig /flushdns`
   - `nslookup www.contoso.com`
10. Verify the IP address returned is **172.16.0.10**.

11. Switch to **LON-CL1** and sign in as `Contoso\Administrator` / `Pa55w.rd`.
12. Right-click **Start** → **Windows Terminal (Admin)**.
13. Run:
   - `ipconfig /flushdns`
   - `nslookup www.contoso.com`
14. Verify the IP address returned is **172.16.0.10**.

------------------------------------------------------------

### Task 2: Configure DNS policies

1. Switch back to **LON-DC1**.
2. Open **Windows PowerShell ISE**.
3. Run:
   - `Import-Module DnsServer`

4. Enter the following commands **one at a time**:

   - `Add-DnsServerClientSubnet -Name "UKSubnet" -IPv4Subnet "172.16.0.0/24"`
   - `Add-DnsServerClientSubnet -Name "CanadaSubnet" -IPv4Subnet "172.16.18.0/24"`
   - `Add-DnsServerZoneScope -ZoneName "Contoso.com" -Name "UKZoneScope"`
   - `Add-DnsServerZoneScope -ZoneName "Contoso.com" -Name "CanadaZoneScope"`
   - `Add-DnsServerResourceRecord -ZoneName "Contoso.com" -A -Name "www" -IPv4Address "172.16.0.41" -ZoneScope "UKZoneScope"`
   - `Add-DnsServerResourceRecord -ZoneName "Contoso.com" -A -Name "www" -IPv4Address "172.16.18.17" -ZoneScope "CanadaZoneScope"`
   - `Add-DnsServerQueryResolutionPolicy -Name "UKPolicy" -Action ALLOW -ClientSubnet "eq,UKSubnet" -ZoneScope "UKZoneScope,1" -ZoneName "Contoso.com"`
   - `Add-DnsServerQueryResolutionPolicy -Name "CanadaPolicy" -Action ALLOW -ClientSubnet "eq,CanadaSubnet" -ZoneScope "CanadaZoneScope,1" -ZoneName "Contoso.com"`

------------------------------------------------------------

### Task 3: Validate DNS name resolution AFTER configuring DNS policies

#### Validate UK client (LON-CL1)

1. Switch to **LON-CL1**.
2. Open **Windows PowerShell (Admin)**.
3. Run:
   - `ipconfig /flushdns`
   - `nslookup www.contoso.com`
4. Verify the IP address returned is **172.16.0.41**.

#### Validate Canada client (TOR-SVR1)

5. Switch to **TOR-SVR1**.
6. Open **Windows PowerShell ISE**.
7. Run:
   - `ipconfig /flushdns`
   - `nslookup www.contoso.com`
8. Verify the IP address returned is **172.16.18.17**.

------------------------------------------------------------

## EXERCISE 2: VALIDATING THE DNS IMPLEMENTATION

### Task 1: Connect the client to the appropriate virtual LAN

1. Switch to **LON-CL1** and sign in as `Contoso\Administrator` / `Pa55w.rd`.
2. Open **Windows Terminal**.
3. Run:
   - `Get-DnsClientServerAddress`
4. Confirm DNS server is **172.16.0.10**.

5. Open **Network Connections** (`network conn`).
6. Disable **London_Network**.
7. Enable **PAC_WAN**.
8. Open **PAC_WAN Properties** → **IPv4 Properties**.
9. Configure:
   - IP address: `172.16.19.50`
   - Subnet mask: `255.255.255.0`
   - Default gateway: `172.16.19.1`
   - Preferred DNS server: `172.16.19.20`
10. Select **OK**.

------------------------------------------------------------

### Task 2: Confirm proper DNS configuration

1. On **LON-CL1**, run:
   - `Clear-DnsClientCache`
   - `Get-DnsClientServerAddress`
2. Confirm DNS server is **172.16.19.20**.

3. Switch to **SYD-SVR1** → **DNS Manager**.
4. Verify **LON-CL1** record shows IP **172.16.19.50**.

5. If incorrect:
   - On **LON-CL1**, run `Register-DnsClient`
   - On **SYD-SVR1**, refresh **Contoso.com**
   - Clear server cache

------------------------------------------------------------

### Task 3: Test external and internal name resolution

1. On **LON-CL1**, run:
   - `Clear-DnsClientCache`
   - `nslookup mail.adatum.com`
2. Verify result: **10.10.0.50**.

3. Run:
   - `nslookup treyresearch.net`
4. Verify result: **172.16.19.20**.

------------------------------------------------------------

## EXERCISE 3: TROUBLESHOOTING DNS

### Task 1: Review the scenario
- Incident ID: **723101**
- User: **Susan Kemp**
- Issue: Cannot access network resources

------------------------------------------------------------

### Task 2: Simulate the problem

1. Switch to **LON-CL1**.
2. Open **File Explorer** → `\\LON-DC1\Labfiles\Mod04`.
3. Copy `Scenario.vbs` to **Documents**.
4. Run the script.

------------------------------------------------------------

### Task 3: Resolve the problem

1. On **LON-CL1**, run:
   - `Get-DnsClientCache`
   - `Clear-DnsClientCache`
   - `test-connection lon-dc1`
   - `Get-DnsClientCache | fl`
   - `nslookup LON-DC1`

2. Open the hosts file:
   - `notepad C:\windows\system32\drivers\etc\hosts`

3. Delete:
   - `172.16.0.1 lon-dc1.contoso.com`
4. Save and close Notepad.

5. Run:
   - `Clear-DnsClientCache`
   - `test-connection lon-dc1`
   - `Get-DnsClientCache | fl`
   - `Resolve-Dnsname LON-DC1 | fl`

6. Open:
   - `\\LON-DC1\Labfiles`

------------------------------------------------------------

## RESULTS
- DNS policies successfully applied
- Clients receive location-based DNS responses
- Name-resolution issue resolved by correcting the hosts file
