## LAB A: Implement DFS for branch offices

### Lab scenario
Contoso Corporation has several key shared folders that must be accessible to users in Sydney and Toronto. The Sydney users access the folders only a few times per day, but the Toronto users access them constantly throughout the day. To ensure that users have the optimal experience when accessing the files, Contoso has decided to implement Distributed File System Replication (DFSR) for the Toronto users.

------------------------------------------------------------

## EXERCISE 1: Implementing DFS

### Scenario
The Toronto office has a single server, `TOR-SVR1`. To support branch-staff requirements, you need to configure DFS to replicate a shared folder named **BranchDocs** between `LON-SVR1` and `TOR-SVR1`.  
The BranchDocs folder in London will remain the primary source for centralized backup, while replication provides faster local access in Toronto.

The main tasks are:
- Install the DFS role on `LON-SVR1` and `TOR-SVR1`
- Create the BranchDocs DFS Namespace
- Add the DataFiles folder to the namespace
- Create a folder target on `TOR-SVR1`
- Configure DFS replication

------------------------------------------------------------

### Task 1: Install the DFS role on LON-SVR1 and TOR-SVR1

1. Sign in to **LON-SVR1** as `Contoso\Administrator` / `Pa55w.rd`.
2. Select **Start** → **Server Manager**.
3. In Server Manager, select **Manage** → **Add Roles and Features**.
4. In the Add Roles and Features Wizard, select **Next**.
5. On the **Select installation type** page, select **Next**.
6. On the **Select destination server** page, select **Next**.
7. On the **Select server roles** page:
   - Expand **File and Storage Services (installed)**  
   - Expand **File and iSCSI Services**
   - Select **DFS Namespaces**
8. In the Add Roles and Features dialog box, select **Add Features**.
9. Select the **DFS Replication** check box, and then select **Next**.
10. On the **Select features** page, select **Next**.
11. On the **Confirm installation selections** page, select **Install**.
12. When the installation completes, select **Close**.
13. Repeat steps **1–12** on **TOR-SVR1**.

------------------------------------------------------------

### Task 2: Create the BranchDocs DFS Namespace

1. Switch to **LON-SVR1**.
2. In Server Manager, select **Tools** → **DFS Management**.
3. In the navigation pane, select **Namespaces**.
4. Right-click **Namespaces** → select **New Namespace**.
5. In the New Namespace Wizard, on the **Namespace Server** page:
   - Server: `LON-SVR1`
   - Select **Next**
6. On the **Namespace Name and Settings** page:
   - Name: `BranchDocs`
   - Select **Next**
7. On the **Namespace Type** page:
   - Ensure **Domain-based namespace** is selected
   - Verify access path will be `\\Contoso.com\BranchDocs`
   - Ensure **Enable Windows Server 2008 mode** is selected
   - Select **Next**
8. On the **Review Settings and Create Namespace** page, select **Create**.
9. When finished, select **Close**.

------------------------------------------------------------

### Task 3: Add the DataFiles folder to the BranchDocs namespace

1. On **LON-SVR1**, in **DFS Management**, right-click `\\Contoso.com\BranchDocs`.
2. Select **New Folder**.
3. In the **New Folder** dialog box:
   - Name: `DataFiles`
   - Select **Add**
4. In the **Add Folder Target** dialog box:
   - Path: `\\LON-SVR1\DataFiles`
   - Select **OK**
5. In the Warning dialog box, select **Yes**.
6. In the **Create Share** dialog box:
   - Local path: `C:\BranchDocs\DataFiles`
   - Select **All users have read and write permissions**
   - Select **OK**
7. In the Warning dialog box, select **Yes**.
8. Select **OK** to close the New Folder dialog box.

------------------------------------------------------------

### Task 4: Create a folder target for DataFiles on TOR-SVR1

1. On **LON-SVR1**, in **DFS Management**:
   - Expand **Namespaces**
   - Expand `\\Contoso.com\BranchDocs`
   - Select **DataFiles**
2. In the details pane, note that only one folder target exists.
3. Right-click **DataFiles** → select **Add Folder Target**.
4. In the **New Folder Target** dialog box:
   - Path: `\\TOR-SVR1\DataFiles`
   - Select **OK**
5. In the Warning dialog box, select **Yes** to create the shared folder.
6. In the **Create Share** dialog box:
   - Local path: `C:\BranchDocs\DataFiles`
   - Select **All users have read and write permissions**
   - Select **OK**
7. In the Warning dialog box, select **Yes** to create the folder.
8. In the **Replication** dialog box, select **Yes**.
9. The **Replicate Folder Wizard** starts.

------------------------------------------------------------

### Task 5: Configure replication for the namespace

1. In the **Replicate Folder Wizard**, on the **Replication Group and Replicated Folder Name** page, accept the defaults, select **Next**.
2. On the **Replication Eligibility** page, select **Next**.
3. On the **Primary Member** page:
   - Select `LON-SVR1`
   - Select **Next**
4. On the **Topology Selection** page:
   - Select **No topology**
   - Select **Next**
5. In the Warning dialog box, select **OK**.
6. On the **Review Settings and Create Replication Group** page, select **Create**.
7. On the **Confirmation** page, select **Close**.
8. In the **Replication Delay** dialog box, select **OK**.
9. In **DFS Management**, expand **Replication** and select `Contoso.com\BranchDocs\DataFiles`.
10. In the **Actions** pane, select **New Topology**.
11. In the **New Topology Wizard**:
    - Select **Full mesh**
    - Select **Next**
12. On the **Replication Group Schedule and Bandwidth** page, select **Next**.
13. On the **Review Settings and Create Topology** page, select **Create**.
14. On the **Confirmation** page, select **Close**, then select **OK** in the Replication Delay dialog box.
15. On the **Memberships** tab, verify the replicated folder exists on both `LON-SVR1` and `TOR-SVR1`.

------------------------------------------------------------

## EXERCISE 2: Validating the deployment

### Task 1: Verify DFSR functionality for TOR-SVR1

1. On **LON-SVR1**, open **File Explorer**.
2. In the address bar, enter `\\Contoso.com\BranchDocs\DataFiles` and press **Enter**.
3. Right-click in an empty area → **New** → **Text Document**.
4. Name the file `Repltest` and press **Enter**.
5. In File Explorer, navigate to `C:\BranchDocs\DataFiles`.
6. Confirm that `Repltest.txt` appears (replication may take a short time).
7. Switch to **TOR-SVR1**.
8. Open **File Explorer** and navigate to `C:\BranchDocs\DataFiles`.
9. Confirm that `Repltest.txt` exists.
   - If it does not appear after one minute or refresh, restart **TOR-SVR1**.

------------------------------------------------------------

### Results
After completing this lab, you have successfully implemented and validated DFS replication for branch offices.


## LAB B: Implement BranchCache

### Lab scenario
Contoso Corporation has several key shared folders that must be accessible to users in remote locations.

- Sydney hosts read-only sales files accessed by London users (25–150 MB).
- Toronto users access and modify files hosted in London throughout the day.
- To optimize performance:
  - **BranchCache** will be used for Sydney file shares.
  - **DFSR** will continue to be used for Toronto users.

------------------------------------------------------------

## EXERCISE 1: Implementing BranchCache

### Scenario
London users require intermittent, read-only access to files hosted on **SYD-SVR1**.  
You must configure **LON-SVR1** as a **Hosted Cache server** and configure clients to use it.

Main tasks:
- Configure SYD-SVR1 for BranchCache
- Prepare a BranchCache-enabled file share
- Configure firewall rules
- Install and configure BranchCache on LON-SVR1
- Configure clients to use Hosted Cache mode

------------------------------------------------------------

### Task 1: Configure SYD-SVR1 to use BranchCache

1. Sign in to **SYD-SVR1** as `Contoso\Administrator` / `Pa55w.rd`.
2. Open **Server Manager** → **Add roles and features**.
3. Select **Next** through:
   - Before you begin
   - Installation type
   - Destination server
4. On **Select server roles**:
   - Expand **File and Storage Services**
   - Expand **File and iSCSI Services**
   - Select **BranchCache for Network Files**
5. Select **Add Features** → **Next** → **Install**.
6. After installation, select **Close**.

7. Open **Local Group Policy Editor**:
   - Start → `gpedit.msc`
8. Navigate to:
   - Computer Configuration  
   - Administrative Templates  
   - Network  
   - **Lanman Server**
9. Edit **Hash Publication for BranchCache**:
   - Set to **Enabled**
   - Select **Allow hash publication only for shared folders on which BranchCache is enabled**
10. Select **OK** and close Group Policy Editor.

------------------------------------------------------------

### Task 2: Prepare a file share for BranchCache

1. On **SYD-SVR1**, open **File Explorer**.
2. Navigate to **C:\**
3. Create a new folder named **Share**.
4. Right-click **Share** → **Properties** → **Sharing** tab.
5. Select **Advanced Sharing**.
6. Check **Share this folder** → select **Caching**.
7. Enable **BranchCache** → select **OK**.
8. Select **OK** → **Close**.

9. Open **Command Prompt**:
