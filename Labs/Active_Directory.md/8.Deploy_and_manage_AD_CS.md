# Exercise 1: Deploy an Offline Root CA

## Scenario
Contoso needs a certificate authority (CA) infrastructure to issue and manage certificates.
You will deploy a **Standalone Offline Root CA** using **Windows Server 2022 AD CS**.
After issuing a subordinate CA certificate, this root CA will be taken offline.

Main goals:
- Allow file sharing so cert files can be copied
- Install and configure a standalone root CA
- Configure CRL and AIA locations
- Ensure DNS name resolution for the CA

## Task 1: Enable File and Printer Sharing
- Sign in to CA-SVR1 as Administrator
- Open Control Panel → Network and Sharing Center
- Change advanced sharing settings
- Under Guest/Public profile:
  - Enable File and Printer Sharing
- Save changes and close

## Task 2: Install and Configure AD CS on CA-SVR1

### Install AD CS Role
- Open Server Manager → Add Roles and Features
- Role-based installation
- Select CA-SVR1
- Add **Active Directory Certificate Services**
- Select **Certification Authority** role service
- Install

### Configure AD CS
- Launch AD CS Configuration Wizard
- Credentials: default
- Role service: Certification Authority
- Setup type: **Standalone CA**
- CA type: **Root CA**
- Private key: **Create new**
- Crypto:
  - Key length: **4096**
  - Hash: default
- CA name: **ContosoRootCA**
- Validity period: default
- Database location: default
- Configure and close wizard

### Configure CRL Distribution Point (CDP)
- Open Certification Authority console
- Right-click ContosoRootCA → Properties → Extensions
- Extension: **CRL Distribution Point (CDP)**
- Add location:
  http://lon-svr1.contoso.com/CertData/<CaName><CRLNameSuffix><DeltaCRLAllowed>.crl
- Enable:
  - Include in CDP extension of issued certs
  - Include in CRLs (Delta CRL)
- Do NOT restart yet

### Configure Authority Information Access (AIA)
- Extension: **Authority Information Access (AIA)**
- Add location:
  http://lon-svr1.contoso.com/CertData/<ServerDNSName>_<CaName><CertificateName>.crt
- Enable:
  - Include in AIA extension
- Restart CA service when prompted

### Publish CRL
- Certification Authority console
- Revoked Certificates → All Tasks → Publish
- Accept defaults

### Export Root CA Certificate
- ContosoRootCA → Properties → View Certificate
- Details → Copy to File
- Format: DER encoded binary (.CER)
- Save to:
  \\lon-svr1\C$\RootCA.cer

### Copy CRL and Cert Files
- From:
  C:\Windows\System32\CertSrv\CertEnroll
- Copy both files to:
  \\lon-svr1\C$

## Task 3: Create DNS Record for Offline Root CA
- Switch to LON-DC1
- Open DNS Manager
- Forward Lookup Zones → Contoso.com
- New Host (A):
  - Name: CA-SVR1
  - IP: 172.16.0.40
- Save and close

## Result
- Standalone Offline Root CA installed
- CRL and AIA configured correctly
- Root CA cert exported and accessible
- DNS resolution enabled for CA-SVR1


# Exercise 2: Deploy an Enterprise Subordinate CA

## Scenario
You now deploy an **Enterprise Subordinate CA** to integrate with Active Directory.
The offline root CA will sign this subordinate CA, then remain offline.

Main goals:
- Install enterprise subordinate CA
- Issue subordinate CA certificate
- Publish root CA cert via Group Policy

## Task 1: Install AD CS on LON-SVR1
- Sign in to LON-SVR1 as Contoso\Administrator
- Add Roles and Features
- Install **AD CS**
- Role services:
  - Certification Authority
  - Certification Authority Web Enrollment
- Configure AD CS:
  - Setup type: **Enterprise CA**
  - CA type: **Subordinate CA**
  - New private key
  - CA name: **Contoso-IssuingCA**
  - Save certificate request to file
- Complete configuration (ignore warnings)

## Task 2: Install Subordinate CA Certificate

### Trust Root CA
- Install RootCA.cer into:
  Trusted Root Certification Authorities (Local Machine)

### Prepare Web Distribution
- Copy:
  - ContosoRootCA.crl
  - CA-SVR1_ContosoRootCA.crt
- Paste into:
  C:\inetpub\wwwroot\CertData

### Submit Subordinate CA Request
- Copy request file:
  LON-SVR1.Contoso.com_Contoso-LON-SVR1-CA.req
- Paste to:
  \\CA-SVR1\C$

### Issue Certificate on Root CA
- On CA-SVR1:
  - Submit new request
  - Issue certificate
  - Export as PKCS#7 (.p7b)
  - Save to:
    \\lon-svr1\C$\SubCA.p7b

### Install Subordinate CA Cert
- On LON-SVR1:
  - Install CA Certificate using SubCA.p7b
  - Start CA service
- Shut down CA-SVR1 (root CA goes offline)

## Task 3: Publish Root CA via Group Policy
- On LON-DC1:
  - Edit Default Domain Policy
  - Computer Configuration →
    Windows Settings →
    Security Settings →
    Public Key Policies →
    Trusted Root Certification Authorities
- Import RootCA.cer from \\lon-svr1\C$
- Close GPMC

## Final Result
- Offline Root CA deployed and secured
- Enterprise Subordinate CA operational
- Root CA trusted by all domain clients
- PKI hierarchy successfully established