# EXERCISE 1 — IMPLEMENT SECURITY POLICIES FOR ACCOUNTS, PASSWORDS, AND ADMIN GROUPS

Scenario:
Contoso wants tighter security around account logons, passwords, and administrative groups. You’ll design and implement GPO settings, fine-grained password policies, restricted groups, and auditing to meet their requirements.

------------------------------------------------------------
## SUPPORTING DOCUMENTATION — REQUIREMENTS SUMMARY

Contoso requirements:

- All users: minimum password length = 8 characters
- IT admins: minimum password length = 10 characters
- All passwords must be complex and stored securely
- All users (except IT admins) must change password every 60 days or less
- IT admins must change password every 30 days or less
- Normal users:
    - Lock after >5 bad password attempts within 20 minutes
    - Auto-unlock after 60 minutes
- IT admins:
    - Lock after 3 bad password attempts
    - Never auto-unlock (must be manually unlocked)
    - IT admin accounts = all members of **IT** group and **Domain Admins**
- No user can reuse any of their last 10 passwords
- Local Administrators group on all member servers must contain:
    - Local Administrator
    - Domain Admins
    - IT
- Domain Admins group must contain only the Administrator account
- Enterprise Admins & Schema Admins must be empty during normal operations
- Other built-in admin groups (Account Operators, Server Operators, etc.) should be empty; if users are added, they should be removed automatically
- All changes to user and group objects in AD DS must be audited

------------------------------------------------------------
## PROPOSAL TABLES (TO FILL IN)

### Password policies and account lockout proposal

Setting                        | All users (domain policy)         | IT admins (fine-grained PSO)
------------------------------ | --------------------------------- | ----------------------------
Enforce password history       | 10 passwords remembered           | 10 passwords remembered
Maximum password age           | 60 days                           | 30 days
Minimum password age           | 1 day                             | 1 day
Minimum password length        | 8 characters                      | 10 characters
Passwords must meet complexity | Enabled                           | Enabled

### GPO strategy proposal

Setting                                | All users (domain policy)         | IT admins (fine-grained PSO)
-------------------------------------- | --------------------------------- | ----------------------------
Store password using reversible enc.   | Disabled                          | Disabled
Account lockout duration               | 60 minutes                        | Until manually unlocked
Account lockout threshold              | 5 invalid logon attempts          | 3 invalid logon attempts
Reset account lockout counter after    | 20 minutes                        | 20 minutes

------------------------------------------------------------
## PROPOSAL QUESTIONS (WRITE YOUR ANSWERS)

Q1: How can you configure IT administrators to have different password and account lockout settings than regular users?
Answer:
- Use a **fine-grained password policy** (Password Settings Object / PSO) applied to the IT and Domain Admins groups.

Q2: How can you identify IT administrators in terms of more restricted password and account lockout settings?
Answer:
- Treat all members of the **IT** group and **Domain Admins** group as IT admins, and target the PSO to those groups.

Q3: How can you meet the requirement to limit the membership list for the local Administrators groups on all member servers to only the local Administrator account, the Domain Admins group, and the IT group?
Answer:
- Use a **GPO with Restricted Groups** applied to member servers (Contoso Servers OU), configuring:
  - Restricted Group: **Administrators**
  - “Members of this group”: Domain Admins, IT, and local Administrator.

Q4: How can you meet the requirement that the Domain Admins group must include only the Administrator account and that the Enterprise Admins and Schema Admins groups must be empty during normal operations?
Answer:
- Manage these groups manually (or via scripts), periodically verify membership, and use **auditing** to detect changes. You can also use Restricted Groups for automatic enforcement if desired.

Q5: How can you meet the requirement that other built-in groups, such as Account Operators and Server Operators, must not contain members?
Answer:
- Use **Restricted Groups** in a GPO (Default Domain Controllers Policy) configured so those groups are defined with **no members**.

Q6: How can you meet the requirement that you must audit all changes to users or groups in AD DS?
Answer:
- Enable **Advanced Audit Policy** (Directory Service Changes and Security Group Management) in the Default Domain Controllers Policy, and configure auditing on the domain object (Contoso.com) for Everyone / relevant principals.

------------------------------------------------------------
## TASK 2 — CONFIGURE PASSWORD SETTINGS FOR ALL USERS

1. Sign in to **LON-DC1** as:
   - `Contoso\Administrator`
   - Password: `Pa55w.rd`

2. Server Manager → Tools → **Group Policy Management**.

3. In GPMC:
   - Forest: Contoso.com → Domains → Contoso.com → Group Policy Objects
   - Select **Default Domain Policy**
   - Right-click **Default Domain Policy** → **Edit**

4. In Group Policy Management Editor:
   - Navigate to:
     `Computer Configuration → Policies → Windows Settings → Security Settings → Account Policies → Password Policy`

5. Configure **Enforce password history**:
   - Open policy
   - Check **Define this policy setting**
   - Keep password history for: **10 passwords remembered**
   - OK

6. Configure **Maximum password age**:
   - Open policy
   - Define this policy setting
   - Password will expire in: **60 days**
   - OK

7. Configure **Minimum password age**:
   - Open policy
   - Define this policy setting
   - Password can be changed after: **1 day**
   - OK

8. Configure **Minimum password length**:
   - Open policy
   - Define this policy setting
   - Password must be at least: **8 characters**
   - OK

9. Configure **Password must meet complexity requirements**:
   - Open policy
   - Define this policy setting
   - **Enabled**
   - OK

10. Configure **Store passwords using reversible encryption**:
    - Open policy
    - Define this policy setting
    - **Disabled**
    - OK

11. Now configure **Account Lockout Policy**:
    - Navigate to:
      `Computer Configuration → Policies → Windows Settings → Security Settings → Account Policies → Account Lockout Policy`

12. **Account lockout duration**:
    - Open policy
    - Define this policy setting
    - Account is locked out for: **60 minutes**
    - OK → accept Suggested Value Changes

13. **Account lockout threshold**:
    - Open policy
    - Define this policy setting
    - Account will lock out after: **5 invalid logon attempts**
    - OK

14. **Reset account lockout counter after**:
    - Open policy
    - Define this policy setting
    - Reset account lockout counter after: **20 minutes**
    - OK

15. Close the Group Policy Management Editor and GPMC.

------------------------------------------------------------
## TASK 3 — CONFIGURE A PSO FOR IT ADMINISTRATORS

1. On **LON-DC1**, Server Manager → Tools → **Active Directory Administrative Center**.

2. In ADAC:
   - In navigation pane, select **Contoso (local)**
   - In details pane, open **System**
   - Open **Password Settings Container**

3. Tasks pane → Password Settings Container → **New → Password Settings**

4. In **Create Password Settings**:
   - Name: `Contoso Administrators Password Settings`
   - Precedence: **10**

5. Configure password rules:
   - **Enforce minimum password length**: checked
   - Minimum password length (characters): **10**
   - **Enforce password history**: checked
   - Number of passwords remembered: **10**
   - **Password must meet complexity requirements**: checked
   - **Store password using reversible encryption**: NOT checked

6. Password age options:
   - Enforce minimum password age: checked
   - User cannot change the password within (days): **1**
   - Enforce maximum password age: checked
   - User must change the password after (days): **30**

7. Account lockout options:
   - Enforce account lockout policy: checked
   - Number of failed logon attempts allowed: **3**
   - Reset failed logon attempts count after (mins): **20**
   - Account will be locked out: **Until an administrator manually unlocks the account**

8. In **Directly Applies To** → **Add**.

   - Enter `IT` → Check Names
   - You’ll get a warning because IT is a **Universal** group.

9. Select **Cancel** and fix the group type via PowerShell:

   - Start → **Windows PowerShell ISE**
   - Run:
     ```powershell
     Get-ADGroup IT
     ```
   - Verify GroupScope = Universal

   - Change scope to Global:
     ```powershell
     Set-ADGroup IT -GroupScope Global
     ```

10. Return to **Create Password Settings** dialog:

    - Directly Applies To → Add
    - Enter: `IT; Domain Admins` → Check Names → OK
    - OK to create the PSO.

11. Verify resultant password settings:

    - In ADAC, go back to **Overview**
    - In Global Search, search for **Tonnie Thomsen** → Enter
    - Select Tonnie → Tasks pane → **View resultant password settings**
    - Confirm: **Contoso Administrators Password Settings** applies (Tonnie is in IT)
    - Close

    - Search for **Susan Kemp** → Enter
    - Tasks → View resultant password settings
    - Confirm: No fine-grained PSO; she gets **Default Domain Policy** settings
    - Close

12. Close ADAC and PowerShell ISE.

------------------------------------------------------------
## TASK 4 — IMPLEMENT ADMINISTRATIVE SECURITY POLICIES

### 4.1 Move member servers into a dedicated OU

1. On **LON-DC1**, Server Manager → Tools → **Active Directory Administrative Center**.

2. In ADAC:
   - Select **Contoso (local)**

3. Create OU:
   - Tasks pane → New → **Organizational Unit**
   - Name: `Contoso Servers` → OK

4. Move servers:
   - In details pane, open **Computers**
   - Select **LON-SVR1**, then Shift+select **LON-SVR2**
   - Tasks pane → **Move**
   - Choose **Contoso Servers** → OK

5. Close ADAC.

### 4.2 Create GPO to restrict local Administrators membership

6. Server Manager → Tools → **Group Policy Management**.

7. In GPMC:
   - Forest: Contoso.com → Domains → Contoso.com
   - Locate **Contoso Servers** OU

8. Right-click **Contoso Servers** → **Create a GPO in this domain, and Link it here**:
   - Name: `Restricted Administrators on Member Servers` → OK

9. Edit the GPO:
   - Right-click GPO → **Edit**

10. In GPME, navigate:
    `Computer Configuration → Policies → Windows Settings → Security Settings → Restricted Groups`

11. Configure Restricted Group:
    - Right-click Restricted Groups → **Add Group**
    - Group: `Administrators` → OK

12. In **Administrators Properties**:
    - Under **Members of this group** → Add
      - Browse → enter: `Domain Admins; IT` → Check Names → OK
    - In the small text box, append `;Administrator` so final members list:
      - `Contoso\Domain Admins`
      - `Contoso\IT`
      - `Administrator`
    - OK

13. Close GPME.

### 4.3 Force policy on LON-SVR1 and verify

14. On **LON-SVR1**:
    - Sign in as `Contoso\Administrator` / `Pa55w.rd`

15. Start → `cmd` → Command Prompt (as Administrator if needed).

16. Run:
    ```cmd
    gpupdate /force
    ```

17. After policy refresh:
    - Start → **Server Manager**
    - Tools → **Computer Management**

18. In Computer Management:
    - Expand `System Tools → Local Users and Groups → Groups`
    - Open **Administrators**
    - Verify membership:
      - `Contoso\Domain Admins`
      - `Contoso\IT`
      - Local `Administrator`

19. Close tools on LON-SVR1 (leave Server Manager if desired).

### 4.4 Ensure built-in operator groups are empty on DCs

20. Back on **LON-DC1**, in **Group Policy Management**:
    - Expand **Domain Controllers**
    - Right-click **Default Domain Controllers Policy** link → **Edit**

21. In GPME:
    - Navigate:
      `Computer Configuration → Policies → Windows Settings → Security Settings → Restricted Groups`

22. For **Server Operators**:
    - Right-click Restricted Groups → Add Group
    - Group: `Server Operators` → OK
    - Leave default: **This group should contain no members**
    - OK

23. For **Account Operators**:
    - Repeat: Add Group → `Account Operators`
    - Keep “no members”
    - OK

24. Close GPME and GPMC.

------------------------------------------------------------
## TASK 5 — IMPLEMENT ADMINISTRATIVE AUDITING

1. On **LON-DC1**, Server Manager → Tools → **Group Policy Management**.

2. In GPMC:
   - Forest: Contoso.com → Domains → Contoso.com → Group Policy Objects
   - Select **Default Domain Controllers Policy**
   - Right-click → **Edit**

3. In GPME, navigate to **Directory Service changes**:
   - `Computer Configuration → Policies → Windows Settings → Security Settings → Advanced Audit Policy Configuration → Audit Policies → DS Access`

4. Open **Audit Directory Service Changes**:
   - Check **Configure the following audit events**
   - Check **Success**
   - OK

5. Navigate to **Account Management**:
   - `Computer Configuration → Policies → Windows Settings → Security Settings → Advanced Audit Policy Configuration → Audit Policies → Account Management`

6. Open **Audit Security Group Management**:
   - Configure the following audit events → **Success**
   - OK

7. Force advanced subcategory audit settings:
   - Navigate:
     `Computer Configuration → Policies → Windows Settings → Security Settings → Local Policies → Security Options`
   - Open:
     **Audit: Force audit policy subcategory settings (Windows Vista or later) to override audit policy category settings**
   - Define this policy setting → **Enabled**
   - OK

8. Close GPME and GPMC.

9. On LON-DC1, open an elevated Command Prompt and run:
   gpupdate /force

10. In Server Manager, select:
    - Tools → Active Directory Users and Computers

11. In ADUC:
    - From the menu, select: View → ensure "Advanced Features" is checked.

12. In the left pane:
    - Expand Contoso.com
    - Right-click Contoso.com → Properties

13. In the Contoso.com Properties dialog:
    - Go to the Security tab
    - Select the Advanced button

14. In Advanced Security Settings for Contoso:
    - Go to the Auditing tab
    - Locate the Success auditing entry for Everyone that currently applies to "This object only"
    - Open that entry

15. In the Auditing Entry for Contoso dialog:
    - Change "Applies to" from:
      - This object only
      to:
      - This object and all descendant objects
    - Click OK

16. Click OK to close:
    - Advanced Security Settings for Contoso
    - Contoso.com Properties

17. Back in ADUC, in the left pane:
    - Expand Contoso.com if necessary
    - Select Users

18. In the right pane, double-click:
    - Domain Admins

19. In the Domain Admins Properties dialog:
    - Go to the Members tab
    - Click Add
    - In “Enter the object names to select”, type:
      Tonnie
    - Click Check Names (ensure it resolves to Contoso\Tonnie)
    - Click OK, then OK again to close the Domain Admins Properties dialog


# EXERCISE 2 — TASK 1
# Stage a Delegated Installation of an RODC


## PART A — Preparation  
(You must remove LON-SVR1 from the domain before prestaging the RODC account.)

1. On **LON-SVR1**, open **Server Manager** → **Local Server**.
2. In *Properties for LON-SVR1*, select the **Contoso.com** domain name.
3. In **System Properties**, select **Change**.
4. Under *Member of*, choose **Workgroup**, enter: `MUNICH`, select **OK**.
5. Approve all prompts:
   - *Welcome to the MUNICH workgroup*
   - *You must restart your computer…*
6. When prompted, select **Restart Now**.
7. After restart, sign in as:
   - **Administrator**
   - **Password:** `Pa55w.rd`

---

## PART B — Remove computer account from AD

8. Switch to **LON-DC1**.
9. Open **Server Manager** → **Tools** → **Active Directory Users and Computers**.
10. Navigate to:  
    **Contoso.com → Contoso Servers**
11. Right-click **LON-SVR1** → **Delete**.
12. Confirm both prompts:
    - *Are you sure?* → **Yes**
    - *Confirm Subtree Deletion* → **Yes**

---

## PART C — Create a new AD site for Munich

13. On **LON-DC1**, open **Active Directory Sites and Services**.
14. Right-click **Sites** → **New Site**.
15. Name the site:  
    `Munich`
16. Select link: **DEFAULTIPSITELINK**
17. Select **OK**, then **OK** again at the AD DS message.

---

## PART D — Prestaging the RODC account

18. Open **Active Directory Administrative Center**.
19. Navigate: **Contoso (local) → Domain Controllers**
20. In the **Tasks** pane, select:  
    **Pre-create a Read-only domain controller account**
21. In the AD DS Installation Wizard:
    - **Next** on the welcome screen
22. **Network Credentials** → select **Next**
23. **Specify the Computer Name** → enter:  
    `LON-SVR1`  
    → **Next**
24. **Select a Site** → choose **Munich** → **Next**
25. **Additional Domain Controller Options**  
    - DNS Server ✔  
    - Global Catalog ✔  
    → **Next**
26. **Delegation of RODC Installation and Administration** → select **Set**
27. In object selection, enter:  
    `Alberto`
28. Select **Check Names** → ensure *Alberto Hermosilla* resolves → **OK**
29. Select **Next**
30. Review summary → **Next**
31. On *Completing the Wizard*, select **Finish**


# EXERCISE 2 — TASK 2
# Run AD DS Installation Wizard on LON-SVR1 (RODC Deployment)


## PART A — Install AD DS Role

1. On **LON-SVR1**, open **Server Manager**.
2. Select **Manage** → **Add Roles and Features**.
3. On *Before you begin* → **Next**
4. *Installation type*: keep **Role-based or feature-based installation** → **Next**
5. *Server selection*: confirm **LON-SVR1** → **Next**
6. *Server roles*: check **Active Directory Domain Services**
7. When prompted, select **Add Features**
8. Continue:
   - *Select features* → **Next**
   - *AD DS* info → **Next**
9. *Confirm installation selections* → **Install**
10. Wait for AD DS binaries to finish installing.
11. When complete, select the **Notification flag** → choose:  
    **Promote this server to a domain controller**

---

## PART B — Promote LON-SVR1 to an RODC

12. In the **AD DS Configuration Wizard**, on *Deployment Configuration*:
    - Choose: **Add a domain controller to an existing domain**
13. Under *Supply the credentials to perform this operation*, select **Change**.
14. Enter credentials:

```
User name: Contoso\Alberto
Password: Pa55w.rd
```

15. Under domain selection:
    - Select **Select**
    - Choose **Contoso.com**
    - **OK** → **Next**

---

## PART C — Use the pre-staged RODC account

16. Wizard detects an existing pre-created RODC account for **LON-SVR1**.
17. On *Domain Controller Options*, choose:
    - **Use existing RODC account**
18. Enter DSRM password (same as normal labs):

```
Password: Pa55w.rd
Confirm:  Pa55w.rd
```

19. Select **Next**

---

## PART D — Complete the RODC Promotion

20. *Additional Options* → accept defaults → **Next**
21. *Paths* → accept defaults → **Next**
22. *Review Options* → **Next**
23. After prerequisites pass → select **Install**

> LON-SVR1 will automatically **restart** and complete the RODC configuration.

# EXERCISE 2 — TASK 3
# Configure the Domain-Wide Password Replication Policy


1. On **LON-DC1**, open **Active Directory Administrative Center**.
2. In the left pane, select **Contoso (local)**.
3. In the center pane, open **IT** group.
4. Right-click **IT** → **Add to another group**.
5. In *Enter the object names to select*, type:

```
Denied RODC Password Replication Group
```

6. Select **Check Names** → **OK**.
7. Close Active Directory Administrative Center.

> This ensures IT members’ passwords are *never cached* on any RODC for security.

# EXERCISE 2 — TASK 4
# Create a Group Allowed to Replicate Passwords to the RODC


1. Open **Active Directory Users and Computers**.
2. Expand **Contoso.com → Users**.
3. Right-click empty space → **New → Group**.
4. Name the group:

```
Munich Allowed RODC Password Replication Group
```

5. Select **OK**, then open the group.
6. On the *Members* tab → **Add**.
7. Enter:

```
Julia
```

8. Select **Check Names** → **OK** → **OK** to close the group.

---

## Associate the Allowed Group with LON-SVR1 (RODC)

9. Open **Active Directory Administrative Center**.
10. Navigate to **Contoso (local) → Domain Controllers**.
11. Open **LON-SVR1** (RODC object).
12. Go to **Extensions → Password Replication Policy**.
13. Select **Add**.
14. Choose:

```
Allow passwords for the account to replicate to this RODC
```

15. Click **OK**.
16. In object selection, type:

```
Munich Allowed RODC Password Replication Group
```

17. **Check Names → OK → OK** to close LON-SVR1 properties.

# EXERCISE 2 — TASK 5
# Evaluate the Resultant Password Replication Policy


1. In **Active Directory Administrative Center**, open **LON-SVR1** again.
2. Go to **Extensions → Password Replication Policy**.
3. Select **Advanced**.

### Review key areas:

- **Accounts whose passwords are stored on this RODC**  
  *Shows which accounts have been cached locally.*

- **Accounts that have authenticated to this RODC**  
  *Shows which accounts have used this RODC for logon.*

4. Select the **Resultant Policy** tab.
5. In the field to test accounts, enter:

```
Julia Linares
```

6. Julia should show:

```
Resultant Policy: Allow
```

7. Close all open windows.


# END OF EXERCISE 2

# EXERCISE 3 — Creating and Associating a Group MSA

## Task 1: Create and Associate an MSA

1. On **LON-DC1**, open **Windows PowerShell ISE**.

2. Run the following commands:

```
Add-KdsRootKey -EffectiveTime ((get-date).addhours(-10))
```

```
New-ADServiceAccount -Name Webservice -DNSHostName LON-DC1 -PrincipalsAllowedToRetrieveManagedPassword LON-DC1$
```

```
Add-ADComputerServiceAccount -Identity LON-DC1 -ServiceAccount Webservice
```

```
Get-ADServiceAccount -Filter *
```

3. Confirm that **Webservice** appears in the output.

---

## Task 2: Install the Group MSA

1. Still on **LON-DC1**, run:

```
Install-ADServiceAccount -Identity Webservice
```

2. Open **Internet Information Services (IIS) Manager**.

3. Expand **LON-DC1 (Contoso\Administrator)** → select **Application Pools**.

4. Right-click **DefaultAppPool** → **Advanced Settings**.

5. Under **Process Model**, select **Identity** → the **…** button.

6. Choose **Custom Account** → **Set**.

7. Enter:

```
Username: Contoso\Webservice$
Password: (leave blank; MSAs do not use a manual password)
```

8. Click **OK** three times.

9. In the **Actions** pane:

- Select **Stop**
- Then select **Start**

10. Close IIS Manager.

**Result:** The group Managed Service Account *Webservice* is created, installed, and assigned to the DefaultAppPool.

---

If you want to continue to the next set of labs, just say **next**.
