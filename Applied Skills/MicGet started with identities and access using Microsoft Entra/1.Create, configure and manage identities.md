======================
NOTES: Microsoft Entra ID — Create, Configure, and Manage Users (and related topics)
======================

Overview
- Every person who needs access to Azure resources needs a Microsoft Entra ID user account.
- After sign-in, Entra ID issues an access token that authorizes what resources/actions the user can access/do.

Working with directories (tenants)
- You can only manage ONE directory (tenant) at a time in the portal/admin center.
- Ways to switch:
  - Directory + Subscription panel
  - “Switch directory” button (toolbar)

View users
- Path: Microsoft Entra admin center → Identity → Users → All users
- “User Type” column shows:
  - Member (internal)
  - Guest (external)

How Entra ID defines users (common categories)
1) Cloud identities
   - Exist only in Entra ID (cloud-only).
   - Examples: admin accounts, users created directly in Entra.
   - Source: Microsoft Entra ID (or External Entra directory if cross-tenant).
2) Directory-synchronized identities
   - Originate in on-prem Active Directory.
   - Synced via Microsoft Entra Connect.
   - Source: Windows Server AD.
3) Guest users
   - External identities invited into your tenant.
   - Examples: vendors/contractors, other org accounts, Microsoft accounts.
   - Source: Invited user.

Exercise notes: Create user + group + group-based licensing
Create a user (example)
- Entra admin center → Identity → Users → All users → + New user → Create new user
- Example fields:
  - UPN: ChrisG
  - Name: Chris Green
  - Password: set a unique password
- Verify user appears in All users.

Create a security group (example)
- Entra admin center → Identity → Groups → All groups → New group
- Example fields:
  - Group type: Security
  - Group name: Marketing
  - Membership type: Assigned
  - Owners: your admin account
  - Members: Chris Green
- Verify group appears in All groups.

Assign a license to a group (group-based licensing)
- Note: license assignment changes are done in Microsoft 365 admin center.
- Flow:
  - Entra: Group → Manage → Licenses (review current state)
  - Microsoft 365 admin center: `admin.microsoft.com`
    - Billing → Licenses → select a license product
    - Groups → + Assign licenses
    - Select group (Marketing) → Assign
  - Confirm assignment shows in both Entra group Licenses and M365 admin center.

Deleted users: restore vs permanently delete
Key rule
- Deleted users are “soft-deleted” for 30 days.
- During 30 days, you can restore the user (properties included).
- After 30 days, deletion becomes permanent and cannot be restored.

Required roles to restore/permanently delete users
- Global administrator
- User administrator
- Partner Tier-1 Support
- Partner Tier-2 Support

Exercise notes: delete + restore
- Delete:
  - Entra admin center → Identity → Users → All users → select checkbox → Delete user
- Restore:
  - Entra admin center → Identity → Users → Deleted users → select user → Restore user
  - Verify user returns to All users.

Groups in Microsoft Entra ID
Why groups matter
- Assign permissions once to a group instead of per-user.
- Add/remove members to grant/deny access quickly.

Group types
1) Security groups
   - Access control / permissions boundary.
   - Often admin-managed.
2) Microsoft 365 groups
   - Collaboration: shared mailbox, calendar, files, SharePoint, etc.
   - Can include external members.

Membership types
- Assigned: manual membership management.
- Dynamic: membership based on rules (department/job title/etc.).
  - Typically requires Entra ID Premium (P1/P2).

Device registration / join models
Microsoft Entra registered devices (BYOD)
- Personal devices registered to Entra for resource access.
- Uses local sign-in (device), with Entra account attached for SSO.
- Often enforced with Intune + Conditional Access.

Microsoft Entra joined devices (work-owned, cloud-first)
- Device joined directly to Entra ID; users sign in with org account.
- Managed via Intune (or co-management with ConfigMgr).
- Supports SSO to cloud resources (and some on-prem scenarios).

Hybrid Microsoft Entra joined devices (hybrid enterprise)
- Joined to on-prem AD AND registered in Entra.
- Common when continuing to rely on:
  - Group Policy
  - Win32 apps requiring AD auth
  - existing imaging/deployment workflows
  - older device support

Device writeback (hybrid/federated scenarios)
- Writes Entra device objects back to on-prem AD (“Registered Devices” container).
- Enables on-prem device-based conditional access scenarios (ex: ADFS claims).
- Often required for Windows Hello for Business (hybrid/federated).

License management: group-based licensing (high-level)
What it solves
- Avoids assigning licenses user-by-user or maintaining complex scripts.
- Entra assigns/removes licenses automatically based on group membership.

Requirements (common)
- Entra ID Premium P1+ OR Office 365 Enterprise E3+ (paid or trial).
- Must have enough licenses for all unique members in licensed groups.

Important behaviors
- Changes usually apply within minutes after membership changes.
- Same license assigned via multiple sources is consumed once.
- Usage location affects service availability; set usage location to avoid issues.

Common group licensing error states (and what they mean)
- Not enough licenses (CountViolation)
  - Fix: add more licenses or free unused licenses.
- Conflicting service plans (MutuallyExclusiveViolation)
  - Fix: disable conflicting plans or remove redundant licenses (ex: E1 vs E3 overlap).
- DependencyViolation
  - Fix: ensure prerequisite plan remains, or remove dependent add-on before removing base plan.
- ProhibitedInUsageLocationViolation
  - Fix: correct Usage location or remove user from licensed group.
- Duplicate proxy addresses (Exchange-related)
  - Fix duplicates, then reprocess group/user.
- LicenseAssignmentAttributeConcurrencyException
  - Usually transient; Entra retries automatically.

Reprocess controls (when needed)
- Group: Group → Licenses → Reprocess
- User: User → Licenses → Reprocess

Migration (direct licensing → group-based licensing) safe approach
1) Keep existing automation running initially.
2) Create/choose licensing groups and add users.
3) Assign licenses to the groups.
4) Verify processing state/audit logs + spot-check user license views.
5) Gradually remove direct assignments (test subset first) to avoid service interruption.

======================
MODULE ASSESSMENT — ANSWERS + WHY
======================

1) DependencyViolation when removing a license
Correct answer:
- Ensure the dependent service plans are reassigned before removing the license.
Why:
- A DependencyViolation means another service still requires that license/plan. You must satisfy the dependency first.

2) Custom security attributes & auditing
Correct answer:
- They provide additional metadata that can be used to categorize and filter access logs for specific attributes.
Why:
- Custom attributes add business-specific context that can be queried and audited in access control scenarios.

3) Advantage of custom security attributes vs group-based models
Correct answer:
- They allow for more granular access control by utilizing specific user attributes rather than group membership.
Why:
- Attributes enable fine-grained, policy-based decisions without relying solely on group membership.

4) Security group vs Microsoft 365 group
Correct answer:
- Security groups manage permissions, while Microsoft 365 groups provide collaboration features.
Why:
- Security groups are for access control; M365 groups add mailboxes, calendars, SharePoint, etc.

5) E3 license conflicts with existing E1 license
Correct answer:
- Disable the E1 license for the user.
Why:
- E1 and E3 have overlapping/conflicting service plans; removing or disabling E1 resolves the conflict.

6) LicenseAssignmentAttributeConcurrencyException
Correct answer:
- Allow Microsoft Entra ID to retry processing the user license automatically.
Why:
- This error is typically transient and Entra retries automatically; no admin action is usually required.

7) Next step after creating a user to ensure access to Azure resources
Correct answer:
- Assign the user a license for the required resources.
Why:
- Authentication exists once the account is created; authorization to services requires licensing.

8) Key benefit of Microsoft Entra ID for cloud identity management
Correct answer:
- It provides centralized identity management, including single sign-on capabilities.
Why:
- Entra ID centralizes identity, authentication, authorization, and SSO across cloud services.

9) Enforcing access based on training certifications
Correct answer:
- By defining certification-specific attributes and using them within access control policies to restrict access.
Why:
- Custom security attributes can be evaluated directly in Conditional Access or resource policies.
